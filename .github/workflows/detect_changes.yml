name: Detect Changes and Prepare for LLM Test Gen

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  detect:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Detect Changed Files
        id: changes
        run: |
          echo "Detecting changed Python files..."
          git fetch origin main || true
          if [ "$(git rev-list --count HEAD)" -eq 1 ]; then
            echo "First commit detected. Listing all Python files."
            find . -name "*.py" > changed_files.txt
          else
            git diff --name-only HEAD~1 HEAD > changed_files.txt
          fi
          echo "Changed files:"
          cat changed_files.txt

      - name: Upload Changed Files Artifact
        uses: actions/upload-artifact@v4
        with:
          name: changed-files
          path: changed_files.txt
